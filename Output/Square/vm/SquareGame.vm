/**
 * Implements the Square Dance game.
 * This simple game allows the user to move a black square around
 * the screen, and change the square's size during the movement.
 * When the game starts, a square of 30 by 30 pixels is shown at the
 * top-left corner of the screen. The user controls the square as follows.
 * The 4 arrow keys are used to move the square up, down, left, and right.
 * The 'z' and 'x' keys are used, respectively, to decrement and increment
 * the square's size. The 'q' key is used to quit the game.
 *//** Constructs a new Square Game. *//*
FIELD  Square square    -> this     0
FIELD  int    direction -> this     1
*/
    
function SquareGame.new 0
/*
*/
    push constant 2
    call Memory.alloc 1
    pop pointer 0
    push constant 0
    push constant 0
    push constant 30
    call Square.new 3
    pop this 0
    push constant 0
    pop this 1
    push pointer 0
    return
/** Disposes this game. */    
function SquareGame.dispose 0
/*
ARG    SquareGame this -> argument 0
*/
    push argument 0
    pop pointer 0
    push this 0
    call Square.dispose 1
    pop temp 0
    push pointer 0
    call Memory.deAlloc 1
    pop temp 0
    push constant 0
    return
/** Moves the square in the current direction. */    
function SquareGame.moveSquare 0
/*
ARG    SquareGame this -> argument 0
*/
    push argument 0
    pop pointer 0
    push this 1
    push constant 1
    eq
    not
    if-goto SquareGame.moveSquare_FALSE_0
    push this 0
    call Square.moveUp 1
    pop temp 0
    goto SquareGame.moveSquare_TRUE_0
label SquareGame.moveSquare_FALSE_0
label SquareGame.moveSquare_TRUE_0
    push this 1
    push constant 2
    eq
    not
    if-goto SquareGame.moveSquare_FALSE_1
    push this 0
    call Square.moveDown 1
    pop temp 0
    goto SquareGame.moveSquare_TRUE_1
label SquareGame.moveSquare_FALSE_1
label SquareGame.moveSquare_TRUE_1
    push this 1
    push constant 3
    eq
    not
    if-goto SquareGame.moveSquare_FALSE_2
    push this 0
    call Square.moveLeft 1
    pop temp 0
    goto SquareGame.moveSquare_TRUE_2
label SquareGame.moveSquare_FALSE_2
label SquareGame.moveSquare_TRUE_2
    push this 1
    push constant 4
    eq
    not
    if-goto SquareGame.moveSquare_FALSE_3
    push this 0
    call Square.moveRight 1
    pop temp 0
    goto SquareGame.moveSquare_TRUE_3
label SquareGame.moveSquare_FALSE_3
label SquareGame.moveSquare_TRUE_3
    push constant 5
    call Sys.wait 1
    pop temp 0
    push constant 0
    return
/** Runs the game: handles the user's inputs and moves the square accordingly */    
function SquareGame.run 2
/*
ARG    SquareGame this -> argument 0
VAR    char       key  -> local    0
VAR    boolean    exit -> local    1
*/
    push argument 0
    pop pointer 0
    push constant 0
    pop local 1
label SquareGame.run_LOOP_START_0
    push local 1
    not
    not
    if-goto SquareGame.run_LOOP_END_0
label SquareGame.run_LOOP_START_1
    push local 0
    push constant 0
    eq
    not
    if-goto SquareGame.run_LOOP_END_1
    call Keyboard.keyPressed 0
    pop local 0
    push pointer 0
    call SquareGame.moveSquare 1
    pop temp 0
    goto SquareGame.run_LOOP_START_1
label SquareGame.run_LOOP_END_1
    push local 0
    push constant 81
    eq
    not
    if-goto SquareGame.run_FALSE_0
    push constant 1
    neg
    pop local 1
    goto SquareGame.run_TRUE_0
label SquareGame.run_FALSE_0
label SquareGame.run_TRUE_0
    push local 0
    push constant 90
    eq
    not
    if-goto SquareGame.run_FALSE_1
    push this 0
    call Square.decSize 1
    pop temp 0
    goto SquareGame.run_TRUE_1
label SquareGame.run_FALSE_1
label SquareGame.run_TRUE_1
    push local 0
    push constant 88
    eq
    not
    if-goto SquareGame.run_FALSE_2
    push this 0
    call Square.incSize 1
    pop temp 0
    goto SquareGame.run_TRUE_2
label SquareGame.run_FALSE_2
label SquareGame.run_TRUE_2
    push local 0
    push constant 131
    eq
    not
    if-goto SquareGame.run_FALSE_3
    push constant 1
    pop this 1
    goto SquareGame.run_TRUE_3
label SquareGame.run_FALSE_3
label SquareGame.run_TRUE_3
    push local 0
    push constant 133
    eq
    not
    if-goto SquareGame.run_FALSE_4
    push constant 2
    pop this 1
    goto SquareGame.run_TRUE_4
label SquareGame.run_FALSE_4
label SquareGame.run_TRUE_4
    push local 0
    push constant 130
    eq
    not
    if-goto SquareGame.run_FALSE_5
    push constant 3
    pop this 1
    goto SquareGame.run_TRUE_5
label SquareGame.run_FALSE_5
label SquareGame.run_TRUE_5
    push local 0
    push constant 132
    eq
    not
    if-goto SquareGame.run_FALSE_6
    push constant 4
    pop this 1
    goto SquareGame.run_TRUE_6
label SquareGame.run_FALSE_6
label SquareGame.run_TRUE_6
label SquareGame.run_LOOP_START_3
    push local 0
    push constant 0
    eq
    not
    not
    if-goto SquareGame.run_LOOP_END_3
    call Keyboard.keyPressed 0
    pop local 0
    push pointer 0
    call SquareGame.moveSquare 1
    pop temp 0
    goto SquareGame.run_LOOP_START_3
label SquareGame.run_LOOP_END_3
    goto SquareGame.run_LOOP_START_0
label SquareGame.run_LOOP_END_0
    push constant 0
    return
